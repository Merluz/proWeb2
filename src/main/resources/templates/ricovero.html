<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/image/icon.png"> <!-- Percorso aggiornato per l'icona -->
    <link rel="stylesheet" href="/css/stylesheet.css"> <!-- Percorso aggiornato per il CSS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <title>Servizio Sanitario</title>
</head>
<body>
    <header>
        <div id="header-container">
            <h1 id="first">Portale Sanità</h1>
            <h1 id="second">Regionale</h1>
        </div>
        <a class="header-link" href="https://www.fascicolosanitario.regione.lombardia.it/">
            <button id="MakeAnAppointment">Prendi Appuntamento</button>
        </a>
    </header>
    <div class="divider">
        <aside class="aside-menu">
            <div class="sidebar">
                <p id="navbar-text">Esplora Portale</p>
                <a href="/" class="sidebar-link">HomePage</a>
                <a href="/ospedali" class="sidebar-link">Ospedali</a>
                <a href="/ricovero" class="sidebar-link">Ricoveri</a>
                <a href="/cittadini" class="sidebar-link">Cittadini</a>
                <a href="/patologia" class="sidebar-link">Patologie</a>
            </div>
            <script src="/js/activeNavbar.js"></script>
            <div class="search-container">
               <form action="#" method="get" th:action="@{/ricovero}">
                    <p class="title-search-container">Filtra</p>
                    <label class="label-data" for="data">Data di ricovero:</label>
                    <input type="date" name="data_inizio">
                    <input type="date" name="data_fine">
                    <hr>
                    <label class="label-data" for="durata">Giorni di ricovero:</label>
                    <span class="filter-span">
                        <span>da</span>
                        <input type="number" name="gg_inizio">
                        <span>a</span>
                        <input type="number" name="gg_fine">
                    </span>
                    <hr>
                    <label class="label-number" for="costo">Costo di ricovero:</label>
                    <span class="filter-span">
                        <span>da</span>
                        <input type="number" name="costo_inizio">
                        <span>a</span>
                        <input type="number" name="costo_fine">
                    </span>
                    <input type="submit" value="Cerca">
                </form>
            </div>
        </aside>
        <div class="master">
            <div class="ordering">
                <form method="get" action="#">
                    <div class="sort-bar">
                        <label for="sort-select">Ordina per:</label>
                        <select id="sort-select" name="order">
                            <option value="COSTOricovero">Costo</option> <!-- Ordinamento per costo -->
                            <option value="DURATAricovero">Durata</option> <!-- Ordinamento per durata -->
                        </select>
                    </div>
                    <button type="submit" name="cercaOrdine" id="ordering-submit">Ordina</button>
                </form>
                <form method="post" action="#">
                    <input type="hidden" name="theme" id="theme-input">
                </form>
                <script>
                    function setTheme(theme) {
                        document.getElementById("theme-input").value = theme;
                        document.forms[0].submit();
                    }
                </script>
            </div>
            <div class="adding-crud" id="adder">
                <button class="adding-btn" id="btn-adder" onclick=""> &#43;</button>
                <p class="adding-text">Aggiungi Ricovero</p>
            </div>
            <div class="container">
                <div class="displayer-results">
                    <div class="titles-results-ricovero">
                        <div class="titles-elements-ricovero" id="delete">
                            <button class="delete-title"> &#10005; </button>
                        </div>
                        <div class="titles-elements-ricovero">COD</div>
                        <div class="titles-elements-ricovero">Cod. Ospedale</div>
                        <div class="titles-elements-ricovero">Costo</div>
                        <div class="titles-elements-ricovero">Data</div>
                        <div class="titles-elements-ricovero">Durata</div>
                        <div class="titles-elements-ricovero">Motivo</div>
                        <div class="titles-elements-ricovero">CSSN</div>
                        <div class="titles-elements-ricovero">
                            <button class="modify-title" id="iconMod"></button>
                        </div>
                    </div>
                    <div class="results-list">
                        <div th:each="ricovero, iterStat : ${ricoveri}" 
                             class="records-ricovero" 
                             id="rec-[[${iterStat.count}]]" 
                             data-count="[[${iterStat.count}]]" 
                             data-codricovero="[[${ricovero.CODricovero}]]">
                            <div class="record-ricovero-displayer">
                                <form action="/eliminaRicovero" method="post" style="display:inline;">
                                    <input type="hidden" name="id" th:value="${ricovero._id}">
                                    <button type="submit" class="delete-title"> &#10005; </button>
                                </form>
                                <div class="result-element" th:text="${ricovero.CODricovero}"></div>
                                <div class="result-element" th:text="${ricovero.CODospedale}"></div>
                                <div class="result-element" th:text="${ricovero.COSTOricovero}"></div>
                                <div class="result-element" th:text="${ricovero.DATAricovero}"></div>
                                <div class="result-element" th:text="${ricovero.DURATAricovero}"></div>
                                <div class="result-element" th:text="${ricovero.MOTIVOricovero}"></div>
                                <div class="result-element" th:text="${ricovero.PAZIENTEricovero}"></div>
                                
                                <!-- Bottone modifica -->
                                <button type="button" class="modify" onclick="handleModifyClick(this)"></button>
                            </div>
                            <!-- Form di modifica nascosto -->
                            <form th:action="@{/modificaRicovero}" method="post" class="form-modify" style="display: none;" onsubmit="return validateForm(this)">
                                <div class="records-ricovero-modify modifing-results" id="new' + index + '">
                                  <div class="alert-banner" style="height: auto; color: red; visibility: hidden; word-wrap: break-word; width: 100%; padding: 5px; box-sizing: border-box;">Inserisci la data di ricovero!</div>


                                    <input type="hidden" name="id" th:value="${ricovero._id}">
                                    
                                    <input type="text" name="CODricovero" th:value="${ricovero.CODricovero}" placeholder="Cod. ricovero">
                                    <input type="text" name="CODospedale" th:value="${ricovero.CODospedale}" placeholder="Cod. ospedale">
                                    <input type="text" name="COSTOricovero" th:value="${ricovero.COSTOricovero}" placeholder="Costo">
                                    <input type="date" name="DATAricovero" th:value="${ricovero.DATAricovero}" placeholder="Data ricovero">
                                    <input type="number" name="DURATAricovero" th:value="${ricovero.DURATAricovero}" placeholder="Durata">
                                    <input type="text" name="MOTIVOricovero" th:value="${ricovero.MOTIVOricovero}" placeholder="Motivo ricovero">
                                    <input type="text" name="PAZIENTEricovero" th:value="${ricovero.PAZIENTEricovero}" placeholder="Paziente">
                                    <button type="submit" class="submit-data">✔</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <p>&copy; 2024 Portale Sanitario Regionale. Tutti i diritti riservati.</p>
    </footer>
    <script>
	    function validateForm(form) {
	        const dateInput = form.querySelector('input[name="DATAricovero"]');
	        const alertBanner = form.querySelector('.alert-banner');
	        
	        if (!dateInput.value) {
	            alertBanner.style.visibility = 'visible';
	            return false;
	        } else {
	            alertBanner.style.visibility = 'hidden';
	            return true;
	        }
	    }


        function changeImg(){
            var iconMod = document.getElementById("iconMod");
            var theme = "${theme}"; // Cambia con il valore di tema passato
            if (theme == "blue") {
                iconMod.src = "/image/dark-edit.png";
            } else {
                iconMod.src = "/image/white-edit.png";
            }
        }
        
        function handleModifyClick(button) {
            var form = button.closest('.records-ricovero').querySelector('.form-modify');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }

        window.onload = function() {
            changeImg(); // Assicurati che l'icona sia aggiornata all'avvio della pagina
        }
    </script>
</body>
</html>
